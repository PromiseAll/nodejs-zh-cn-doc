<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>new Agent([options]) | Node.js API 文档</title>
  
  

    <link href="../../api/static/inject.css" rel="stylesheet"><link rel="icon" sizes="32x32" type="image/png" href="../../api/static/favicon.png"></head>

<body class="alt apidoc" id="page_api_item">
  <div id="api-section-http">
    <div id="content" class="clearfix">

      <div id="column1" data-id="__ID__" class="interior">
        <header>
          <h1>new Agent([options])</h1>
          <div id="gtoc">
            <ul>
              <li>v16.16.0</li>
              <li>
                <a href="../http.html#http_new_agent_options" name="toc">返回上层文档</a>
              </li>

              <li class="picker-header">
    <a href="#">
        <span class="collapsed-arrow">►</span><span class="expanded-arrow">▼</span>
        其他版本
      </a>
    <div class="picker"><ol id="alt-docs">
    <li><a href="../../api/http/new_agent_options.html">18.6.0</a></li><li><a href="">16.16.0</a></li><li><a href="../../api-v14/http/new_agent_options.html">14.20.0</a></li>
</ol></div>
  </li>

              <li>
                <a href="http://api.nodejs.cn/" class="link-to-search">搜索</a>
              </li>
              <li>
                
                
              </li>

              <!-- <li>
                <a href="https://github.com/nodejscn/node-api-cn/edit/master/http/#new-agentoptions.md" rel="nofollow">提交修改</a>
              </li> -->
              <!-- <li>
                <a href="/gzh/">公众号</a>
              </li> -->
              <!-- <li class="biz_wrap" data-biz="api_item_nav">
                <a target="_blank" class="biz_title biz_link"></a>
              </li> -->
            </ul>
          </div>
          <hr>
        </header>

        <div id="apicontent">
          <div id="content_left"><div class="api_metadata">
<details class="changelog" open=""><summary>版本历史</summary>
<table>
<tbody><tr><th>版本</th><th>变更</th></tr>
<tr><td>v15.6.0</td>
<td><p>将默认调度从 'fifo' 更改为 'lifo'。</p></td></tr>
<tr><td>v14.5.0, v12.20.0</td>
<td><p>添加 <code>scheduling</code> 选项指定空闲套接字调度策略。</p></td></tr>
<tr><td>v14.5.0, v12.19.0</td>
<td><p>添加 <code>maxTotalSockets</code> 选项到代理构造函数。</p></td></tr>
<tr><td>v0.3.4</td>
<td><p><span>新增于: v0.3.4</span></p></td></tr>
</tbody></table>
</details>
</div><ul class="">
<li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" rel="nofollow" class="type">&lt;Object&gt;</a> 要在代理上设置的可配置选项集。
可以有以下字段：
<ul>
<li><code>keepAlive</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" rel="nofollow" class="type">&lt;boolean&gt;</a> 即使没有未完成的请求，也要保留套接字，这样它们就可以用于未来的请求，而无需重新建立 TCP 连接。
不要与 <code>Connection</code> 标头的 <code>keep-alive</code> 值混淆。
使用代理时总是发送 <code>Connection: keep-alive</code> 标头，除非显式指定了 <code>Connection</code> 标头或当 <code>keepAlive</code> 和 <code>maxSockets</code> 选项分别设置为 <code>false</code> 和 <code>Infinity</code>，在这种情况下将使用 <code>Connection: close</code>。 <strong>默认值:</strong> <code>false</code>。</li>
<li><code>keepAliveMsecs</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> 使用 <code>keepAlive</code> 选项时，指定 TCP Keep-Alive 数据包的<a href="../net.html#socketsetkeepaliveenable-initialdelay">初始延迟</a>。
当 <code>keepAlive</code> 选项为 <code>false</code> 或 <code>undefined</code> 时则忽略。 <strong>默认值:</strong> <code>1000</code>。</li>
<li><code>maxSockets</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> 每个主机允许的最大套接字数量。
如果同一主机打开多个并发连接，则每个请求都将使用新的套接字，直到达到 <code>maxSockets</code> 值。
如果主机尝试打开的连接数超过 <code>maxSockets</code>，则额外的请求将进入待处理请求队列，并在现有连接终止时进入活动连接状态。
这确保在任何时间点，给定的主机最多有 <code>maxSockets</code> 个活动连接。
<strong>默认值:</strong> <code>Infinity</code>。</li>
<li><code>maxTotalSockets</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> 所有主机总共允许的最大套接字数量。
每个请求将使用新的套接字，直到达到最大值。
<strong>默认值:</strong> <code>Infinity</code>。</li>
<li><code>maxFreeSockets</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> 每台主机在空闲状态下保持打开的最大套接字数。
仅当 <code>keepAlive</code> 设置为 <code>true</code> 时才相关。
<strong>默认值:</strong> <code>256</code>。</li>
<li><code>scheduling</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" rel="nofollow" class="type">&lt;string&gt;</a> 选择下一个要使用的空闲套接字时应用的调度策略。
它可以是 <code>'fifo'</code> 或 <code>'lifo'</code>。
两种调度策略的主要区别在于 <code>'lifo'</code> 选择最近使用的套接字，而 <code>'fifo'</code> 选择最近最少使用的套接字。
在每秒请求率较低的情况下，<code>'lifo'</code> 调度将降低选择可能因不活动而被服务器关闭的套接字的风险。
在每秒请求率较高的情况下，<code>'fifo'</code> 调度将最大化打开套接字的数量，而 <code>'lifo'</code> 调度将保持尽可能低。
<strong>默认值:</strong> <code>'lifo'</code>。</li>
<li><code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> 套接字超时（以毫秒为单位）。
这将在创建套接字时设置超时。</li>
</ul>
</li>
</ul><p><a href="../net.html#socketconnectoptions-connectlistener"><code>socket.connect()</code></a> 中的 <code>options</code> 也受支持。</p><p class=""><a href="../http.html#httprequestoptions-callback"><code>http.request()</code></a> 使用的默认 <a href="../http.html#httpglobalagent"><code>http.globalAgent</code></a> 将所有这些值设置为各自的默认值。</p><p class="">要配置其中任何一个，则必须创建自定义的 <a href="../http.html#class-httpagent"><code>http.Agent</code></a> 实例。</p><pre class=""><code class="language-js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> keepAliveAgent = <span class="hljs-keyword">new</span> http.<span class="hljs-title class_">Agent</span>({ <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> });
options.<span class="hljs-property">agent</span> = keepAliveAgent;
http.<span class="hljs-title function_">request</span>(options, onResponseCallback);</code></pre></div>
          <div id="content_right"><div class="api_metadata">
<details class="changelog" open=""><summary>History</summary>
<table>
<tbody><tr><th>Version</th><th>Changes</th></tr>
<tr><td>v15.6.0</td>
<td><p>Change the default scheduling from 'fifo' to 'lifo'.</p></td></tr>
<tr><td>v14.5.0, v12.20.0</td>
<td><p>Add <code>scheduling</code> option to specify the free socket scheduling strategy.</p></td></tr>
<tr><td>v14.5.0, v12.19.0</td>
<td><p>Add <code>maxTotalSockets</code> option to agent constructor.</p></td></tr>
<tr><td>v0.3.4</td>
<td><p><span>Added in: v0.3.4</span></p></td></tr>
</tbody></table>
</details>
</div><ul>
<li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" rel="nofollow" class="type">&lt;Object&gt;</a> Set of configurable options to set on the agent.
Can have the following fields:
<ul>
<li><code>keepAlive</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" rel="nofollow" class="type">&lt;boolean&gt;</a> Keep sockets around even when there are no
outstanding requests, so they can be used for future requests without
having to reestablish a TCP connection. Not to be confused with the
<code>keep-alive</code> value of the <code>Connection</code> header. The <code>Connection: keep-alive</code>
header is always sent when using an agent except when the <code>Connection</code>
header is explicitly specified or when the <code>keepAlive</code> and <code>maxSockets</code>
options are respectively set to <code>false</code> and <code>Infinity</code>, in which case
<code>Connection: close</code> will be used. <strong>Default:</strong> <code>false</code>.</li>
<li><code>keepAliveMsecs</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> When using the <code>keepAlive</code> option, specifies
the <a href="../net.html#socketsetkeepaliveenable-initialdelay">initial delay</a>
for TCP Keep-Alive packets. Ignored when the
<code>keepAlive</code> option is <code>false</code> or <code>undefined</code>. <strong>Default:</strong> <code>1000</code>.</li>
<li><code>maxSockets</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> Maximum number of sockets to allow per host.
If the same host opens multiple concurrent connections, each request
will use new socket until the <code>maxSockets</code> value is reached.
If the host attempts to open more connections than <code>maxSockets</code>,
the additional requests will enter into a pending request queue, and
will enter active connection state when an existing connection terminates.
This makes sure there are at most <code>maxSockets</code> active connections at
any point in time, from a given host.
<strong>Default:</strong> <code>Infinity</code>.</li>
<li><code>maxTotalSockets</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> Maximum number of sockets allowed for
all hosts in total. Each request will use a new socket
until the maximum is reached.
<strong>Default:</strong> <code>Infinity</code>.</li>
<li><code>maxFreeSockets</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> Maximum number of sockets per host to leave open
in a free state. Only relevant if <code>keepAlive</code> is set to <code>true</code>.
<strong>Default:</strong> <code>256</code>.</li>
<li><code>scheduling</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" rel="nofollow" class="type">&lt;string&gt;</a> Scheduling strategy to apply when picking
the next free socket to use. It can be <code>'fifo'</code> or <code>'lifo'</code>.
The main difference between the two scheduling strategies is that <code>'lifo'</code>
selects the most recently used socket, while <code>'fifo'</code> selects
the least recently used socket.
In case of a low rate of request per second, the <code>'lifo'</code> scheduling
will lower the risk of picking a socket that might have been closed
by the server due to inactivity.
In case of a high rate of request per second,
the <code>'fifo'</code> scheduling will maximize the number of open sockets,
while the <code>'lifo'</code> scheduling will keep it as low as possible.
<strong>Default:</strong> <code>'lifo'</code>.</li>
<li><code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" rel="nofollow" class="type">&lt;number&gt;</a> Socket timeout in milliseconds.
This will set the timeout when the socket is created.</li>
</ul>
</li>
</ul><p><code>options</code> in <a href="../net.html#socketconnectoptions-connectlistener"><code>socket.connect()</code></a> are also supported.</p><p>The default <a href="../http.html#httpglobalagent"><code>http.globalAgent</code></a> that is used by <a href="../http.html#httprequestoptions-callback"><code>http.request()</code></a> has all
of these values set to their respective defaults.</p><p>To configure any of them, a custom <a href="../http.html#class-httpagent"><code>http.Agent</code></a> instance must be created.</p><pre><code class="language-js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> keepAliveAgent = <span class="hljs-keyword">new</span> http.<span class="hljs-title class_">Agent</span>({ <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> });
options.<span class="hljs-property">agent</span> = keepAliveAgent;
http.<span class="hljs-title function_">request</span>(options, onResponseCallback);</code></pre></div>
          <div></div>
        </div>

        <!-- <div id="biz_item" class="biz_wrap" data-biz="api_item">
          <a target="_blank" class="biz_link">
            <img class="biz_img" />
          </a>
        </div> -->
      </div>
    </div>
  </div>
  
  <div id="wxpaycode_box" style="display: none;">
    <div id="wxpaycode_img_box">
      <div id="wxpaycode_vip_tips">
        因经营维护成本巨大，
        <br>为了能提供更高质量的中文文档，
        <br>即日起将只对VIP会员开放。
        <br>扫码成为VIP会员，会员费用为<span id="wxpaycode_vip_money">199</span>元/年
      </div>
      <img id="wxpaycode_img">
    </div>
  </div>
  
  
  



    <script src="../../api/static/inject.js" defer=""></script></body></html>